---
apiVersion: v1
kind: Namespace
metadata:
  name: radio
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  namespace: radio
  name: radio-recorder
spec:
  selector:
    matchLabels:
      app: radio-recorder
  template:
    metadata:
      labels:
        app: radio-recorder
    spec:
      containers:
      - name: radio-recorder
        image: radio-recorder
        lifecycle:
          preStop:
            exec:
              command: ["sh", "-c", "rm -f /RadioRecProcess.lock; sleep 5"]
        volumeMounts:
        - name: data
          mountPath: /data/radio
        - name: radio-config
          mountPath: /data/config
        env:
        - name: TZ
          value: Asia/Tokyo
      volumes:
        - name: data
          hostPath:
            path: /data/radio
        - name: radio-config
          configMap:
            name: radio-properties
---
apiVersion: v1
kind: ConfigMap
metadata:
  namespace: radio
  name: radio-properties
data:
  radio.properties: |
    ### プログラムの起動モード
    ### true=常時起動して設定された時間に繰り返し実行、ロックファイル削除かSIGTERMで終了
    ### false=開始時間から終了時間まで一度実行して終了）
    process: true

    ### NHK第2放送のURI
    radio.uri: https://nhkradioakr2-i.akamaihd.net/hls/live/511929/1-r2/1-r2-01.m3u8

    ### 録音ファイル保存ディレクトリ
    base.dir: /data/radio

    ### 録音ファイル名
    mp3.file: jh_eng.mp3

    ### 録音を実行する開始時間、終了時間
    start.time: 06:30
    end.time: 06:45

    ### プログラムの起動モード = PROCESSの時、録音を実行する曜日
    sunday: false
    monday: true
    tuesday: true
    wednesday: true
    thursday: true
    friday: true
    saturday: false
